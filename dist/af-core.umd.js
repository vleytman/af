!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).AF=t()}(this,(function(){"use strict";let e={prefix:"af-",breakpoints:{sm:"(max-width: 640px)",md:"(min-width: 641px) and (max-width: 768px)",lg:"(min-width: 769px) and (max-width: 1024px)",xl:"(min-width: 1025px) and (max-width: 1280px)",xxl:"(min-width: 1281px)"},engine:"gsap",debug:!0};const t={log:(...e)=>{s.Config.debug&&console.log("[AF]",...e)},warn:(...e)=>{s.Config.debug&&console.warn("[AF]",...e)},error:(...e)=>{s.Config.debug&&console.error("[AF]",...e)}},r={deepMergeObjects(e,t){if(Array.isArray(e)&&Array.isArray(t))return t.slice();if(Array.isArray(t))return t.slice();if(Array.isArray(e))return t;if("object"==typeof e&&"object"==typeof t&&null!==e&&null!==t){const r={...e};return Object.keys(t).forEach((n=>{r[n]=this.deepMergeObjects(e[n],t[n])})),r}return t},mergeConfig(e){s.Config=this.deepMergeObjects(s.Config,e),s.Config.breakpoints=e.breakpoints??s.Config.breakpoints},hasElementsWithAttributes:(e,t)=>e.some((e=>t.some((t=>Object.keys(e.attributes).includes(t))))),generateRandomName:()=>Math.random().toString(36).substring(2,10),kebabCase:e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),debounce(e,t){let r;return function(...n){clearTimeout(r),r=setTimeout((()=>{clearTimeout(r),e(...n)}),t)}},getBreakpointMaxWidth(e){const t=e.match(/\(max-width:\s*(\d+)px\)/),r=e.match(/\(min-width:\s*(\d+)px\)/);return t?parseInt(t[1]):r?1/0:0}},n={parsers:{timeline:{flow:["disallowEmpty","parseTimelineValue"],responsive:!0},from:{flow:["disallowEmpty","parseObjectAttribute","parseJsonToObjectOrArray","normalizeAttributeValues"],responsive:!0},to:{flow:["disallowEmpty","parseObjectAttribute","parseJsonToObjectOrArray","normalizeAttributeValues"],responsive:!0},keyframes:{flow:["disallowEmpty","parseObjectAttribute","parseJsonToObjectOrArray","normalizeAttributeValues","parseKeyframesValue"],responsive:!0},options:{flow:["disallowEmpty","parseObjectAttribute","parseJsonToObjectOrArray","normalizeAttributeValues"],responsive:!0},target:{flow:["parseSelectorValue"],responsive:!1},on:{flow:["disallowEmpty","parseOnValue"],responsive:!0},action:{flow:["disallowEmpty","parseActionValue"],responsive:!0},scroll:{flow:["parseObjectAttribute","parseJsonToObjectOrArray","normalizeAttributeValues"],responsive:!0},splittext:{flow:["parseSplitTextValue"],responsive:!0},pause:{flow:["parseEmptyValue"],responsive:!0}},parseElements(){const e=Array.from(new Set([...this.getAnimatableElements(),...this.getAnimatableElementsByPreset()]));if(e)return this.processAttributes(e)},getAnimatableElementsByPreset:()=>Object.entries(s.Config.presets).flatMap((([e,t])=>{const n=`${s.Config.prefix}${r.kebabCase(e)}`;return[...document.getElementsByClassName(n)].map((t=>(t.setAttribute(`${s.Config.prefix}preset`,e),t)))})),processAttributes(e){if(!e)return;let r=[];return e.forEach((e=>{try{r.push(this.parseSingleElement(e))}catch{t.error("Can't parse element:",e)}})),r=this.propagateBreakpoints(r),r},parseSingleElement(e){const t=this.parseElementAttributes(e);return{element:e,attributes:t,targets:this.getTargets({element:e,attributes:t})}},propagateBreakpoints(e){const t=Object.keys(s.Config.breakpoints).sort(((e,t)=>{const n=r.getBreakpointMaxWidth(s.Config.breakpoints[e]);return r.getBreakpointMaxWidth(s.Config.breakpoints[t])-n}));return e.map((e=>{for(const[n,i]of Object.entries(e.attributes))if(this.parsers[n]&&this.parsers[n].responsive){const a="default"in i;Object.keys(i).filter((e=>"default"!==e&&e in s.Config.breakpoints));let o={};a&&(o=r.deepMergeObjects({},i.default)),t.forEach((t=>{t in i&&(o=r.deepMergeObjects(o,i[t])),e.attributes[n][t]=r.deepMergeObjects({},o)})),a&&delete e.attributes[n].default}return e}))},getTargets(e){if("&"===e.attributes?.target||!e.attributes?.target)return[e.element];const t=e.attributes.target.trim(),r=t.slice(1).trim();if(t.startsWith("&")){const t=this.getMatchedElements(e.element,r);return t.length?t:[e.element]}return document.querySelectorAll(t)},getMatchedElements:(e,t)=>t.match(/^([.#\[])/)&&e.matches(t)?[e]:t.startsWith(">")?[...e.children].filter((e=>e.matches(t.slice(1).trim()))):[...e.querySelectorAll(t)],getAnimatableElements:()=>Array.from(document.querySelectorAll("*")).filter((e=>Array.from(e.attributes).some((e=>e.name.startsWith(s.Config.prefix))))),parseElementAttributes(e){let r={},n=null;if(Array.from(e.attributes).forEach((i=>{if(i.name!==`${s.Config.prefix}preset`){if(i.name.startsWith(s.Config.prefix)){const n=this.extractAttributeComponents(i.name);if(!n)return;const{type:s,breakpoint:a}=n;if(!this.parsers[s])return void t.warn(`Unknown attribute: ${i.name}`);let o=this.runParsers(e,s,i.value);o?(r[s]=r[s]??{},r[s][a]=o,r[s]=this.checkIfResponsiveAttribute(r[s],s)):t.warn(`Error parsing "${s}" attribute value: ${i.value}`)}}else n=i.value.trim()})),n){const t=this.parsePresetAttributes(n,e);this.deepMergeAttributes(r,t)}return r},extractAttributeComponents(e){const r=e.slice(s.Config.prefix.length).match(/^([a-zA-Z]+)(?:-([a-zA-Z0-9]+))?$/);return r[2]&&!s.Config.breakpoints[r[2]]?(t.warn(`Invalid breakpoint: ${r[2]}`),null):r?{type:r[1],breakpoint:r[2]||"default"}:null},runParsers(e,t,r){try{let n={},s=null;for(const i of this.parsers[t].flow)n=s?this[i](s,e):this[i](r,e),s=n;return n}catch(e){return null}},disallowEmpty(e,t){if(""===e)throw new Error("Empty value for attribute is not allowed");return e},checkIfResponsiveAttribute:(e,t)=>n.parsers[t].responsive?e:e[Object.keys(e)[0]],parsePresetAttributes(e,r){const n=s.Config.presets[e];return n?Object.entries(n).reduce(((n,[i,a])=>{if("selector"===i)return n;const[,o,l="default"]=i.match(/^([a-zA-Z]+)(?:-([a-zA-Z0-9]+))?$/)||[];if(!o||!this.parsers[o])return t.warn(`Invalid or unknown preset attribute: "${i}"`),n;if("default"!==l&&!s.Config.breakpoints[l])return t.warn(`Invalid breakpoint "${l}" in preset "${e}" for type "${o}"`),n;let u=this.runParsers(r,o,a);return u?n[o]={...n[o],[l]:u}:t.warn(`Error parsing "${o}" attribute value: ${a}`),n}),{}):(t.warn(`Preset "${e}" not found`),{})},parseObjectAttribute(e,t){return"object"==typeof e?e:(e=this.resolveVariables(e,t),e=(e=this.escapeCommas(e)).replace(/'/g,'"').replace(/\s+/g," ").trim().replace(/(^|[,{]\s*)([^\s,"'{}[\]:]+)(\s*:)/g,'$1"$2"$3').replace(/(:\s*)([^,{}\[\]\s][^,{}\[\]]*)(?=[,}\]]|$)/g,((e,t,r)=>{const n=r.trim();return n.startsWith("[")||n.startsWith("{")||/^-?\d+(\.\d+)?$/.test(n)||/^(true|false|null)$/i.test(n)?`${t}${n}`:/^".*"$/.test(n)?e:`${t}"${n}"`})).replace(/__COMMA__/g,","))},escapeCommas(e){let t="",r=0,n=!1,s="";const i={"(":")","[":"]","{":"}"},a=[];for(let o=0;o<e.length;o++){const l=e[o];n?(t+=l,l===s&&(n=!1)):'"'===l||"'"===l?(n=!0,s=l,t+=l):i[l]?(a.push(i[l]),r++,t+=l):a.length>0&&l===a[a.length-1]?(a.pop(),r--,t+=l):t+=","===l&&r>0?"__COMMA__":l}return t},deepMergeAttributes(e,t){for(const[n,s]of Object.entries(t))if(e[n])for(const[t,i]of Object.entries(s))e[n][t]?e[n][t]=r.deepMergeObjects(e[n][t],i):e[n][t]=i;else e[n]=r.deepMergeObjects({},s)},resolveVariables(e,t){let r=e.replace(/var\((--[^)]+)\)/g,((e,r)=>getComputedStyle(t).getPropertyValue(r).trim()||"undefined"));return r=r.replace(/\${([^}]+)}/g,((e,r)=>this.evaluateExpression(r.trim(),this.getElementContext(t)))),r},evaluateExpression:(()=>{const e=new Map;return(r,n)=>{e.has(r)||e.set(r,new Function('"use strict";return ('+r+")"));try{return e.get(r).call(n)}catch(e){return void t.error(`Error evaluating expression: ${r}`,e)}}})(),getElementContext:e=>({$element:e,window:window,document:document}),parseJsonToObjectOrArray(e,r){if("object"==typeof e)return e;try{return JSON.parse(`{${e}}`)}catch(r){try{return JSON.parse(`[${e}]`)}catch(r){return t.error("Error parsing attribute value:",e,r),null}}},normalizeAttributeValues(e){return Array.isArray(e)?e.map((e=>this.normalizeAttributeValues(e))):null!==e&&"object"==typeof e?Object.fromEntries(Object.entries(e).map((([e,t])=>[e,this.normalizeAttributeValues(t)]))):this.normalizeValue(e)},normalizeValue(e){if("number"==typeof e)return e;if("string"!=typeof e)return e;const t=e.trim();return/^-?\d+(\.\d+)?$/.test(t)?Number(t):/^(true|false)$/i.test(t)?"true"===t.toLowerCase():e},parseTimelineValue(e){const t=e.split(/,(?![^{}]*})/).map((e=>e.trim()));if(t.length>3)throw new Error(`Invalid timeline value: ${e}. Expected format: name[, position][, properties]`);return 1===t.length?{name:String(t[0]),position:null}:2===t.length?{name:t[0],position:this.normalizeValue(t[1])}:{name:t[0],position:this.normalizeValue(t[1]),options:this.normalizeAttributeValues(this.parseJsonToObjectOrArray(this.parseObjectAttribute(t[2],null),null))[0]}},parseSelectorValue:(e,t)=>e.trim(),parseOnValue:(e,t)=>({events:e.split(",").map((e=>e.trim()))}),parseActionValue(e,t){const[r,n,...s]=e.split(/,(?![^{}]*})/).map((e=>e.trim()));if(!n||!r)throw new Error(`Invalid action format: "${e}", needs at least target and action.`);const i=s.join(",").trim();return{action:r,target:n,arguments:i?i.startsWith("{")&&i.endsWith("}")?this.normalizeAttributeValues(this.parseJsonToObjectOrArray(this.parseObjectAttribute(i,t),t)):this.normalizeValue(i):{}}},parseKeyframesValue:(e,t)=>e,parseSplitTextValue(e,t){if("object"==typeof e)return e;if(e.includes(":"))return e=this.parseObjectAttribute(e,t),e=this.parseJsonToObjectOrArray(e,t),e=this.normalizeAttributeValues(e);return{type:e.split(",").map((e=>e.trim())).filter((e=>e.length>0)).join(", ")}},parseEmptyValue:(e,t)=>!0,getTimelines(e){const t={},n=(e,n)=>{const{attributes:s,element:i,targets:a}=e,o=s.timeline?.[n]?.name??s.timeline?.default?.name??(i.id.length?i.id:null)??r.generateRandomName();t[n]??={},t[n][o]??={animations:[],options:{}};const l=Object.fromEntries(Object.entries(s).filter((([,e])=>e[n]||e.default&&"default"===n)).map((([e,t])=>[e,t[n]??t.default])));t[n][o].animations.push({element:i,attributes:l,targets:a}),0===Object.keys(t[n][o].options).length&&(t[n][o].options=this.getTimelineOptions(s.timeline))};return e.forEach((e=>{const t=new Set(Object.values(e.attributes).flatMap((e=>Object.keys(e))));t.has("default")&&(t.delete("default"),n(e,"default")),t.forEach((t=>n(e,t)))})),Object.fromEntries(Object.entries(t).filter((([e])=>isNaN(e))))},getTimelineOptions(e){if(!e)return{};for(const t in e)if(e[t]&&e[t].options)return e[t].options;return{}}},s={debug:t,utils:r,Parser:n,Config:e,engines:{},registerEngine(e,t,r){s.engines[e]={},s.engines[e].engineClass=t,s.engines[e].plugins=r,console.debug("AF Engine registered",s.engines[e])},init(t=null){if(!s.engines)return;t&&s.utils.mergeConfig(t);const r=n.parseElements(),i=n.getTimelines(r),a=s.engines[e.engine].engineClass;if(!a)return void this.debug.error(`Incorrect animation engine: ${s.Config.engine}`);const o=new a(r,i);o.init&&"function"==typeof o.init&&o.init(s.engines[e.engine],s.Config)}};return console.debug("AF load"),s}));
//# sourceMappingURL=af-core.umd.js.map
