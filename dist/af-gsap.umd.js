!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("./af-core.js")):"function"==typeof define&&define.amd?define(["./af-core"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).AFEngineGSAP=t(e.AF)}(this,(function(e){"use strict";return class{gsapTimelines=[];elements=[];timelines={};matchMedia=null;gsap=null;plugins=null;defaults={scrollTrigger:{start:"top 90%",end:"bottom 10%",toggleActions:"play reverse play reverse",scrub:!1,invalidateOnRefresh:!0},scrollSmoother:{enabled:!1,options:{smooth:1,effects:!0,smoothTouch:.1}},allDefaults:{force3D:!0,lazy:!1},actions:{play:(e,t,i,s)=>{const n=this.getTimelineByName(e,s);n&&n.play()},pause:(e,t,i,s)=>{const n=this.getTimelineByName(e,s);n&&n.pause()},restart:(e,t,i,s)=>{const n=this.getTimelineByName(e,s);n&&n.restart()},reverse:(e,t,i,s)=>{const n=this.getTimelineByName(e,s);n&&n.reverse()},toggle:(e,t,i,s)=>{const n=this.getTimelineByName(e,s);n&&(n.reversed()?n.play():n.reverse())}}};constructor(e,t){this.elements=e,this.timelines=t}init(t,i){e.Config=i,t?.plugins?.gsap||window.gsap?(this.gsap=t?.plugins?.gsap||window.gsap,this.plugins=t?.plugins||{},this.loadRequiredPlugins(this.elements),this.initScrollSmoother(),this.matchMedia=this.gsap.matchMedia(),this.animate()):e.debug.error("GSAP core not found")}loadRequiredPlugins(t){e.utils.hasElementsWithAttributes(t,["scroll"])&&(this.plugins.ScrollTrigger=this.plugins?.ScrollTrigger||ScrollTrigger,this.gsap.registerPlugin(this.plugins.ScrollTrigger)),e.utils.hasElementsWithAttributes(t,["splittext"])&&(this.plugins.SplitText=this.plugins?.SplitText||SplitText,this.gsap.registerPlugin(this.plugins.SplitText))}animate(){if(this.timelines){this.cleanup();for(const[t,i]of Object.entries(this.timelines))this.matchMedia.add(e.Config.breakpoints[t],(e=>{for(let[e,s]of Object.entries(i)){s=this.prepareTimeline(s);const i={...this.getScrollTrigger(s,s?.scrollElement)},n=this.gsap.timeline({...s.options,...i});s.pause&&n.pause(),this.gsapTimelines.push({name:e,breakpoint:t,timeline:n});for(const e of s.animations){const i=this.createSingleAnimation(e,t);n.add(i,e.attributes?.timeline?.position??0)}}this.setupEventActions(t,e)}));this.handleResize(),this.handlePageShow(),this.handleLoad(),this.refresh()}}setupEventActions(e,t){this.elements.forEach((i=>{const{element:s,attributes:n,targets:l}=i;if(n?.on?.[e]&&n?.action?.[e]){const i=n.on[e].events,s=n.action[e];i.forEach((i=>{l.forEach((n=>{const l=t=>{this.handleAction(s.action,s.target,s.arguments,t,e)};t.add((()=>(n.addEventListener(i,l),()=>{n.removeEventListener(i,l)})))}))}))}}))}handleAction(t,i,s,n,l){"function"==typeof this.defaults.actions[t]?this.defaults.actions[t](i,n,s,l):"function"==typeof e.Config.actions[t]?e.Config.actions[t](i,n,s,l):e.debug.warn(`Action "${t}" not found.`)}getTimelineByName(e,t){const i=this.gsapTimelines.find((i=>i.name===e&&i.breakpoint===t));return i?i.timeline:null}refresh(){this.plugins.ScrollTrigger&&this.plugins.ScrollTrigger.update(),this.plugins.ScrollTrigger&&this.plugins.ScrollTrigger.getAll().forEach((e=>e.refresh()))}handleLoad(){window.addEventListener("load",(()=>this.refresh()))}handleResize(){window.addEventListener("resize",e.utils.debounce((()=>this.refresh()),200),{passive:!0})}handlePageShow(){window.addEventListener("pageshow",(e=>e.persisted&&this.refresh()&&this.animate()))}getConfig(t){return e.Config[t]??this.defaults[t]??null}getScrollTrigger(e,t){if(!e.scroll)return{};return{scrollTrigger:{trigger:t,...0===Object.keys(e.scroll).length?this.getConfig("scrollTrigger"):e.scroll}}}getSplitText(e,t){if(!e.splittext)return t;const i=e.splittext,s=new this.plugins.SplitText(t,i),n=(i.type||"").split(",").map((e=>e.trim()));let l=[];return n.includes("chars")&&(l=l.concat(s.chars)),n.includes("words")&&(l=l.concat(s.words)),n.includes("lines")&&(l=l.concat(s.lines)),0===l.length&&(l=t),l}prepareTimeline(e){let t=null,i=!1;return e.animations.forEach((e=>{e.attributes?.scroll&&(t=t||{scroll:e.attributes.scroll??t,scrollElement:e.element??scrollElement},delete e.attributes.scroll),e.attributes?.pause&&(i=i||{pause:!0},delete e.attributes.pause)})),{...e,...t,...i}}createSingleAnimation(e,t){const{element:i,attributes:s,targets:n}=e;let l={...this.getScrollTrigger(s,i),...this.getConfig("allDefaults")},o=this.getSplitText(s,n);return s.keyframes?this.gsap.to(o,{keyframes:s.keyframes,...s?.options,...l}):s.from&&!s.to?this.gsap.from(o,{...s.from,...s?.options,...l}):s.to&&!s.from?this.gsap.to(o,{...s.to,...s?.options,...l}):s.from&&s.to?this.gsap.fromTo(o,s.from,{...s.to,...s?.options,...l}):void 0}initScrollSmoother(){if(!this.getConfig("scrollSmoother")?.enabled)return;this.plugins.ScrollSmoother=this.plugins?.ScrollSmoother||ScrollSmoother,this.gsap.registerPlugin(this.plugins.ScrollSmoother);document.querySelector("#smooth-content")?this.plugins.ScrollSmoother.create({...this.getConfig("scrollSmoother").options,wrapper:"#smooth-wrapper",content:"#smooth-content"}):e.debug.error("ScrollSmoother: No #smooth-content found")}cleanup(){this.plugins.ScrollTrigger&&this.plugins.ScrollTrigger.killAll(),this.gsapTimelines&&(this.gsapTimelines.forEach((({timeline:e})=>e.kill())),this.gsapTimelines=[])}}}));
//# sourceMappingURL=af-gsap.umd.js.map
